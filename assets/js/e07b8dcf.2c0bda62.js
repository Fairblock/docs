"use strict";(self.webpackChunkfairblock_docusaurus=self.webpackChunkfairblock_docusaurus||[]).push([[9197],{4570:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>o,contentTitle:()=>a,default:()=>p,frontMatter:()=>c,metadata:()=>d,toc:()=>s});var i=t(1527),r=t(7214);const c={sidebar_position:3},a="IBE",d={id:"build/appchain/ts-ibe",title:"IBE",description:"In this tutorial, you will learn about the IBE typescript module.",source:"@site/docs/build/appchain/ts-ibe.md",sourceDirName:"build/appchain",slug:"/build/appchain/ts-ibe",permalink:"/docs/build/appchain/ts-ibe",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:3,frontMatter:{sidebar_position:3},sidebar:"tutorialSidebar",previous:{title:"Private Governance",permalink:"/docs/build/appchain/private-governance"},next:{title:"EVM App Tutorials",permalink:"/docs/build/evm_apps/"}},o={},s=[{value:"1. Input Parameters",id:"1-input-parameters",level:3},{value:"2. Create Timelock Encrypter",id:"2-create-timelock-encrypter",level:3},{value:"3. Encrypt Age",id:"3-encrypt-age",level:3},{value:"4. Convert to Hex",id:"4-convert-to-hex",level:3},{value:"Example",id:"example",level:2}];function l(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,r.a)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h1,{id:"ibe",children:"IBE"}),"\n",(0,i.jsx)(n.p,{children:"In this tutorial, you will learn about the IBE typescript module."}),"\n",(0,i.jsx)(n.h3,{id:"1-input-parameters",children:"1. Input Parameters"}),"\n",(0,i.jsxs)(n.p,{children:["To encrypt voting data, you will receive the following input parameters:\n",(0,i.jsx)(n.code,{children:"identity"}),", ",(0,i.jsx)(n.code,{children:"publicKey"}),", and ",(0,i.jsx)(n.code,{children:"votingOption"})," data as bytes."]}),"\n",(0,i.jsx)(n.h3,{id:"2-create-timelock-encrypter",children:"2. Create Timelock Encrypter"}),"\n",(0,i.jsxs)(n.p,{children:["And then, create ",(0,i.jsx)(n.code,{children:"timelock encrypter"})," from ",(0,i.jsx)(n.code,{children:"identity"})," and ",(0,i.jsx)(n.code,{children:"publicKey"}),"."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'function createTimelockEncrypter(identity: string, pubKey: string) {\n  return async (fileKey: Uint8Array): Promise<Array<Stanza>> => {\n    const idByte = new TextEncoder().encode(identity);\n    const point = PointG1.fromHex(pubKey);\n    const ciphertext = await ibe.encryptOnG1(point, idByte, fileKey);\n    return [\n      {\n        type: "distIBE",\n        args: [`${identity}`],\n        body: serialisedCiphertext(ciphertext),\n      },\n    ];\n  };\n}\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.code,{children:"identity"})," is a string, so convert it to bytes.\nThen, encrypt ",(0,i.jsx)(n.code,{children:"identity"})," and ",(0,i.jsx)(n.code,{children:"publicKey"})," with random ",(0,i.jsx)(n.code,{children:"fileKey"})," by using ",(0,i.jsx)(n.a,{href:"https://www.npmjs.com/package/@noble/bls12-381",children:"@noble/bls12-381"}),", and return this encrypter function."]}),"\n",(0,i.jsx)(n.h3,{id:"3-encrypt-age",children:"3. Encrypt Age"}),"\n",(0,i.jsxs)(n.p,{children:["Now, you can encrypt ",(0,i.jsx)(n.code,{children:"votingOption"})," data using ",(0,i.jsx)(n.code,{children:"timelock encrypter"})," and ",(0,i.jsx)(n.code,{children:"fileKey"}),". ",(0,i.jsx)(n.code,{children:"fileKey"})," is just random 32 bytes."]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:"export async function encryptAge(\n  plaintext: Uint8Array,\n  wrapFileKey: EncryptionWrapper = NoOpEncDec.wrap\n): Promise<string> {\n  const fileKey = await random(fileKeyLengthBytes);\n  const recipients = await wrapFileKey(fileKey);\n  const body = await encryptedPayload(fileKey, plaintext);\n\n  return writeAge({\n    fileKey,\n    version: ageVersion,\n    recipients,\n    headerMacMessage,\n    body,\n  });\n}\n"})}),"\n",(0,i.jsx)(n.h3,{id:"4-convert-to-hex",children:"4. Convert to Hex"}),"\n",(0,i.jsx)(n.p,{children:"Finally, convert the encrypted data to a hex string and then return it."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-typescript",children:'return Buffer.from(agePayload, "binary").toString("hex");\n'})}),"\n",(0,i.jsx)(n.h2,{id:"example",children:"Example"}),"\n",(0,i.jsx)(n.p,{children:"Original voting data:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n  "identity": "1/rq",\n  "publicKey": "99d54aeb64f6d91ed1ab668448cfffe9217e3d3ed24861856ef070eb075df6149e6a1d0a7d7594e5b0cdfc8f44db5e8d",\n  "voteOption": {\n      "option": 1, // 1: yes, 2: no, etc\n      "randomNo": 1698938287829\n  }\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"Converted voting data:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-json",children:'{\n    "identity": "1/rq",\n    "publicKey": "99d54aeb64f6d91ed1ab668448cfffe9217e3d3ed24861856ef070eb075df6149e6a1d0a7d7594e5b0cdfc8f44db5e8d",\n    "voteOptionBytes": {\n        "0": 8,\n        "1": 1,\n        "2": 16,\n        "3": 213,\n        "4": 237,\n        "5": 243,\n        "6": 132,\n        "7": 185,\n        "8": 49\n    }\n}\n'})}),"\n",(0,i.jsx)(n.p,{children:"Encrypted voting data:"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"6167652d656e6372797074696f6e2e6f72672f76310a2d3e20646973744942450a7279516b31304c47444c694b4e35394933427851614e4d66306662726a716f6b7957443354467836376d4476526d4971434f63617a6e366d7077587a663374780a7348644833736437707061696a2b50683763354e58394351384b4c4665556d55675436464c4d467473726c6247305a39514e6d6c3469536f3644577a2b3055500a69757778306e6776583538744166743679354a5951410a2d2d2d20394778323845546439726775577a78643131546f746b6171596c64643176704d4a42564c594e68414d55550a009f72364d582c6364bf7e9d2a325db41a8621cb712b80eae001823f061a0565959c50ed4cea5827b1\n"})})]})}function p(e={}){const{wrapper:n}={...(0,r.a)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(l,{...e})}):l(e)}},7214:(e,n,t)=>{t.d(n,{Z:()=>d,a:()=>a});var i=t(959);const r={},c=i.createContext(r);function a(e){const n=i.useContext(c);return i.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:a(e.components),i.createElement(c.Provider,{value:n},e.children)}}}]);