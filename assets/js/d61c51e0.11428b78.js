"use strict";(self.webpackChunkfairblock_docusaurus=self.webpackChunkfairblock_docusaurus||[]).push([[8284],{6380:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>h,frontMatter:()=>s,metadata:()=>o,toc:()=>l});var r=i(1527),t=i(7214);const s={sidebar_position:6},a="Metrics",o={id:"running-a-node/metrics",title:"Metrics",description:"fairyring & fairyringclient provide support for metrics to allow users to monitor the health, performance and status of fairyring & fairyringclient.",source:"@site/docs/running-a-node/metrics.md",sourceDirName:"running-a-node",slug:"/running-a-node/metrics",permalink:"/docs/running-a-node/metrics",draft:!1,unlisted:!1,tags:[],version:"current",sidebarPosition:6,frontMatter:{sidebar_position:6},sidebar:"tutorialSidebar",previous:{title:"ShareGenerationClient",permalink:"/docs/running-a-node/share_generation_client"},next:{title:"FAQs",permalink:"/docs/category/faqs"}},c={},l=[{value:"<code>fairyring</code> setup",id:"fairyring-setup",level:2},{value:"<code>fairyringclient</code> setup",id:"fairyringclient-setup",level:3},{value:"Prometheus installation and Setup",id:"prometheus-installation-and-setup",level:3},{value:"Visualization",id:"visualization",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",...(0,t.a)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.h1,{id:"metrics",children:"Metrics"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"fairyring"})," & ",(0,r.jsx)(n.code,{children:"fairyringclient"})," provide support for metrics to allow users to monitor the health, performance and status of ",(0,r.jsx)(n.code,{children:"fairyring"})," & ",(0,r.jsx)(n.code,{children:"fairyringclient"}),"."]}),"\n",(0,r.jsxs)(n.h2,{id:"fairyring-setup",children:[(0,r.jsx)(n.code,{children:"fairyring"})," setup"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"fairyring"})," uses ",(0,r.jsx)(n.a,{href:"https://prometheus.io/",children:"Prometheus"})," to publish metrics, It can be enabled through the ",(0,r.jsx)(n.code,{children:"config.toml"})," file."]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-toml",children:'#######################################################\n###       Instrumentation Configuration Options     ###\n#######################################################\n[instrumentation]\n\n# When true, Prometheus metrics are served under /metrics on\n# PrometheusListenAddr.\n# Check out the documentation for the list of available metrics.\nprometheus = true\n\n# Address to listen for Prometheus collector(s) connections\nprometheus_listen_addr = ":26660"\n\n# Maximum number of simultaneous connections.\n# If you want to accept a larger number than the default, make sure\n# you increase your OS limits.\n# 0 - unlimited.\nmax_open_connections = 3\n\n# Instrumentation namespace\nnamespace = "fairyring"\n'})}),"\n",(0,r.jsxs)(n.p,{children:["After enabling metrics in ",(0,r.jsx)(n.code,{children:"config.toml"}),", If you restart your node, you can check if the metrics are working by:"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:"curl localhost:26660/metrics"})}),"\n",(0,r.jsxs)(n.h3,{id:"fairyringclient-setup",children:[(0,r.jsx)(n.code,{children:"fairyringclient"})," setup"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.code,{children:"fairyringclient"})," enables metrics on port ",(0,r.jsx)(n.code,{children:":2222"})," by default, you can check your metrics port by:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"fairyringclient config show\n"})}),"\n",(0,r.jsx)(n.p,{children:"Example Output:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"Using config file: /Users/fairblock/.fairyringclient/config.yml\nGRPC Endpoint: 127.0.0.1:9090\nFairyRing Node Endpoint: http://127.0.0.1:26657\nChain ID: fairyring-testnet-1\nChain Denom: ufairy\nInvalidSharePauseThreshold: 5\nMetricsPort: 2222\n"})}),"\n",(0,r.jsx)(n.p,{children:"You can update the metrics port by the following command:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"fairyringclient config update --metrics-port NEW_PORT\n"})}),"\n",(0,r.jsx)(n.h3,{id:"prometheus-installation-and-setup",children:"Prometheus installation and Setup"}),"\n",(0,r.jsxs)(n.p,{children:["After enabling metrics on ",(0,r.jsx)(n.code,{children:"fairyring"})," node / ",(0,r.jsx)(n.code,{children:"fairyringclient"}),", you will need a program to scrape its data, we suggest using ",(0,r.jsx)(n.code,{children:"Prometheus"})," in this example."]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Install Prometheus by following the ",(0,r.jsx)(n.a,{href:"https://prometheus.io/docs/prometheus/latest/installation/",children:"Official Installation guide"})," in the same machine as your node."]}),"\n",(0,r.jsxs)(n.li,{children:["Create a Prometheus config file, we will create one at ",(0,r.jsx)(n.code,{children:"$HOME/.fairyring/config/prometheus.yml"})," in this example."]}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:"The config file should look something like this:"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yml",children:"global:\n  scrape_interval: 15s # Set the scrape interval to every 15 seconds. Default is every 1 minute.\n\n# A scrape configuration containing exactly one endpoint to scrape:\n# Here it's Prometheus itself.\nscrape_configs:\n  # The job name is added as a label `job=<job_name>` to any timeseries scraped from this config.\n  - job_name: 'Fairyring'\n    scrape_interval: 5s\n    static_configs:\n      - targets: ['localhost:26660']\n  - job_name: 'FairyringClient'\n    scrape_interval: 5s\n    static_configs:\n      - targets: ['localhost:2222']\n"})}),"\n",(0,r.jsxs)(n.ol,{start:"3",children:["\n",(0,r.jsx)(n.li,{children:"Start Prometheus server:"}),"\n"]}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.code,{children:'prometheus --config.file="$HOME/.fairyring/config/prometheus.yml" --web.listen-address="0.0.0.0:2112"'})}),"\n",(0,r.jsxs)(n.p,{children:["Prometheus runs its server on port ",(0,r.jsx)(n.code,{children:"9090"})," by default, we suggest to run Prometheus in a different port, ",(0,r.jsx)(n.code,{children:"2112"})," in this case, to avoid conflict with the ",(0,r.jsx)(n.code,{children:"fairyring"})," node gRPC port (",(0,r.jsx)(n.code,{children:"9090"})," by default`)."]}),"\n",(0,r.jsx)(n.h2,{id:"visualization",children:"Visualization"}),"\n",(0,r.jsxs)(n.p,{children:["After installing Prometheus and enabling ",(0,r.jsx)(n.code,{children:"fairyring"})," metrics, you will need something to visualize the data.\nWe suggest using ",(0,r.jsx)(n.a,{href:"https://grafana.com/",children:"Grafana"})," for building a dashboard to visualize the data."]}),"\n",(0,r.jsxs)(n.p,{children:["You can use their cloud service of run it yourself.\nYou can follow their ",(0,r.jsx)(n.a,{href:"https://grafana.com/docs/grafana/latest/setup-grafana/installation/",children:"Official Installation Guide"})," for a tutorial on installing ",(0,r.jsx)(n.code,{children:"Grafana"}),".\nAfter installing ",(0,r.jsx)(n.code,{children:"Grafana"}),", you can start it by:"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"grafana server\n"})}),"\n",(0,r.jsxs)(n.p,{children:["The command above will start a server on ",(0,r.jsx)(n.code,{children:"localhost:3000"}),"."]}),"\n",(0,r.jsxs)(n.p,{children:["After you started a Grafana server, you can now create your own dashboard or import the one we already created for ",(0,r.jsx)(n.a,{href:"https://raw.githubusercontent.com/Fairblock/fairyring/main/fairyring_dashboard.json",children:(0,r.jsx)(n.code,{children:"fairyring"})})," & ",(0,r.jsx)(n.a,{href:"https://raw.githubusercontent.com/Fairblock/fairyringclient/main/fairyringclient_dashboard.json",children:(0,r.jsx)(n.code,{children:"fairyringclient"})}),"."]})]})}function h(e={}){const{wrapper:n}={...(0,t.a)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(d,{...e})}):d(e)}},7214:(e,n,i)=>{i.d(n,{Z:()=>o,a:()=>a});var r=i(959);const t={},s=r.createContext(t);function a(e){const n=r.useContext(s);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),r.createElement(s.Provider,{value:n},e.children)}}}]);